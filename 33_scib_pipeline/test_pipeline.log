/apps/gent/RHEL8/haswell-ib/software/Python/3.10.4-GCCcore-11.3.0/lib/python3.10/site-packages/paramiko/transport.py:236: CryptographyDeprecationWarning: Blowfish has been deprecated
  "class": algorithms.Blowfish,
Building DAG of jobs...
Using shell: /usr/bin/bash
Provided cores: 8
Rules claiming more threads will be scaled down.
Job stats:
job               count    min threads    max threads
--------------  -------  -------------  -------------
metrics               1              1              1
metrics_single        3              1              1
total                 4              1              1

Select jobs to execute...

[Tue Feb 28 01:13:06 2023]
Job 4: 
        Metrics hvg=full_feature,method=scanorama,o_type=embed,scaling=unscaled,scenario=test_data_r4_small
        output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/scanorama_embed.csv
        
Reason: Missing output files: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/scanorama_embed.csv


[Tue Feb 28 01:13:06 2023]
Job 6: 
        Metrics hvg=full_feature,method=bbknn,o_type=knn,scaling=unscaled,scenario=test_data_r4_small
        output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/bbknn_knn.csv
        
Reason: Missing output files: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/bbknn_knn.csv


[Tue Feb 28 01:13:06 2023]
Job 1: 
        Metrics hvg=full_feature,method=combat,o_type=full,scaling=unscaled,scenario=test_data_r4_small
        output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/combat_full.csv
        
Reason: Missing output files: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/combat_full.csv

[Tue Feb 28 01:13:45 2023]
Error in rule metrics_single:
    jobid: 6
    input: data/adata_norm.h5ad, /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/bbknn.h5ad
    output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/bbknn_knn.csv
    shell:
        
        python scripts/metrics/metrics.py -u data/adata_norm.h5ad -i /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/bbknn.h5ad          -o /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/bbknn_knn.csv -m bbknn          -b batch -l celltype --type knn          --hvgs 0 --organism mouse --assay expression -v
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Options
    type:	full
    batch_key:	batch
    label_key:	celltype
    assay:	expression
    organism:	mouse
    n_hvgs:	None
    setup:	combat_full
    optimised clustering results:	/kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/combat_full_nmi.txt
reading adata before integration
AnnData object with n_obs × n_vars = 2730 × 3451
    obs: 'paul15_clusters', 'celltype', 'batch', 'n_counts'
    uns: 'iroot', 'log1p'
    layers: 'counts'
reading adata after integration
AnnData object with n_obs × n_vars = 2730 × 3451
    obs: 'paul15_clusters', 'celltype', 'batch', 'n_counts'
    uns: 'iroot', 'log1p'
    layers: 'counts'
reduce integrated data:
    HVG selection:	None
    compute neighbourhood graph:	True on X_pca
    precompute PCA:	True
PCA
Nearest Neigbours
computing metrics
type:	full
    ASW:	True
    NMI:	True
    ARI:	True
    PCR:	True
    cell cycle:	True
    iso lab F1:	True
    iso lab ASW:	True
    HVGs:	True
    kBET:	True
    LISI:	True
    Trajectory:	False
Clustering...
Traceback (most recent call last):
  File "/kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/scripts/metrics/metrics.py", line 239, in <module>
    results = scib.me.metrics(
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib/1.1.3-foss-2022a/lib/python3.10/site-packages/scib/metrics/metrics.py", line 293, in metrics
    res_max, nmi_max, nmi_all = opt_louvain(
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/Deprecated/1.2.13-foss-2022a/lib/python3.10/site-packages/deprecated/classic.py", line 285, in wrapper_function
    return wrapped_(*args_, **kwargs_)
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib/1.1.3-foss-2022a/lib/python3.10/site-packages/scib/metrics/clustering.py", line 203, in opt_louvain
    sc.tl.louvain(adata, resolution=res, key_added=cluster_key)
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scanpy/1.9.1-foss-2022a/lib/python3.10/site-packages/scanpy/tools/_louvain.py", line 151, in louvain
    part = louvain.find_partition(
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/lib/python3.10/site-packages/louvain/functions.py", line 68, in find_partition
    partition = partition_type(graph,
  File "/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/lib/python3.10/site-packages/louvain/VertexPartition.py", line 769, in __init__
    self._partition = _c_louvain._new_RBConfigurationVertexPartition(pygraph_t,
BaseException: Could not construct partition: vector::_M_default_append
[Tue Feb 28 01:13:56 2023]
Error in rule metrics_single:
    jobid: 1
    input: data/adata_norm.h5ad, /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/combat.h5ad
    output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/combat_full.csv
    shell:
        
        python scripts/metrics/metrics.py -u data/adata_norm.h5ad -i /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/combat.h5ad          -o /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/combat_full.csv -m combat          -b batch -l celltype --type full          --hvgs 0 --organism mouse --assay expression -v
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

[Tue Feb 28 01:14:25 2023]
Error in rule metrics_single:
    jobid: 4
    input: data/adata_norm.h5ad, /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/scanorama.h5ad
    output: /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/scanorama_embed.csv
    shell:
        
        python scripts/metrics/metrics.py -u data/adata_norm.h5ad -i /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/integration/unscaled/full_feature/scanorama.h5ad          -o /kyukon/scratch/gent/vo/001/gvo00117/easybuild/RHEL8/haswell-ib/software/scib-pipeline/20221014-foss-2022a/pipeline/data/scib-R4.0_small/test_data_r4_small/metrics/unscaled/full_feature/scanorama_embed.csv -m scanorama          -b batch -l celltype --type embed          --hvgs 0 --organism mouse --assay expression -v
        
        (one of the commands exited with non-zero exit code; note that snakemake uses bash strict mode!)

Exiting because a job execution failed. Look above for error message
Complete log: .snakemake/log/2023-02-28T011304.651790.snakemake.log
