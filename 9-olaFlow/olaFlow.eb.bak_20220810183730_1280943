easyblock = 'Tarball'

name = 'olaFlow'
version = '20210820'
local_commit = 'b3039e055a22ea0b8c7dc9f735f15686976559f6'

homepage = 'https://olaflow.github.io/'
description = """olaFlow CFD Suite is a free and open source project committed to bringing the latest
advances for the simulation of wave dynamics to the OpenFOAMÂ® and FOAM-extend communities."""

sources = [{
    'source_urls': ['https://github.com/phicau/olaFlow/archive/'],
    'filename': '%s.tar.gz' % local_commit,
    'download_filename': '%(name)s-%(version)s.tar.gz',
}]

toolchain = {'name': 'foss', 'version': '2021b'}

dependencies = [
    ('OpenFOAM', 'v2112')
]

postinstallcmds = ["source $FOAM_BASH && "
                   "export FOAM_USER_APPBIN=%(installdir)s/bin && "
                   "export FOAM_USER_LIBBIN=%(installdir)s/lib && "
                   "./allMake"]

sanity_check_paths = {
    'files': ["bin/olaFlow", "lib/libwaveGeneration.so"],
    'dirs': []
}

sanity_check_commands = ["olaFlow -help"]

moduleclass = 'cae'
